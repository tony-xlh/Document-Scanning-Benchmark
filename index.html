<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document Scanning Benchmark</title>
  <style>
    table, th, td {
      border: 1px solid black;
      text-align: center;
      overflow: auto;
    }

    .fileRow {
      cursor: pointer;
    }

    .fileRow:hover {
      background-color: #f5f5f5;
    }

    .fileRow.selected {
      background-color: #f0f0f0;
    }

    .content {
      display: flex;
      flex-wrap: wrap;
    }

    .left-container {
      flex-basis: 60%;
    }

    .right-container {
      flex-basis: 40%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-container {
      max-height: 80vh;
      width: 100%;
      height: 100%;
      overflow: auto;
    }
</style>
</head>
<html>
<body>
  <div id="app">
    <h2>Document Scanning Benchmark</h2>
    <div class="content">
      <div class="left-container">
        <label>
          Select dataset files:
          <input type="file" multiple id="fileInput"/>
        </label>
        </br>
        <button id="startButton">Start Benchmark</button>
        <button id="readExistingButton">Read Existing Benchmark Result</button>
        <div class="result">
          <h3>Result:</h3>
          <div id="resultTable"></div>
        </div>
      </div>
      <div class="right-container">
        <div class="image-container">
          <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="imageSVG"></svg>
        </div>
      </div>
    </div>
  </div>
  <script>
    registerEvents();

    function registerEvents(){
      document.getElementById('fileInput').addEventListener('change', listDataset);
      document.getElementById('startButton').addEventListener('click', startBenchmark);
      document.getElementById('readExistingButton').addEventListener('click', readExistingBenchmarkResult);
    }

    function startBenchmark(){

    }

    function readExistingBenchmarkResult(){

    }

    function listDataset(){
      document.getElementById("resultTable").innerHTML = "";
      let table = document.createElement("table");
      let head = table.createTHead();
      head.innerHTML = "<tr><th>No.</th><th>Filename</th><th>Detected</th></tr>";
      let body = table.createTBody();
      let files = document.getElementById("fileInput").files;
      let number = 0;
      for (let i = 0; i < files.length; i++){
        let file = files[i];
        console.log(file);
        if (file.name.indexOf(".txt") != -1){
          continue;
        }
        number = number + 1;
        let row = body.insertRow();
        row.className = "fileRow";
        row.addEventListener('click', function(){
          toggleSelected(row,file);
        });
        let numberCell = row.insertCell();
        numberCell.innerHTML = number;
        let filenameCell = row.insertCell();
        filenameCell.innerHTML = file.name;
        let detectedCell = row.insertCell();
      }
      document.getElementById("resultTable").appendChild(table);
    }

    function toggleSelected(row,file) {
      let rows = document.getElementsByClassName("fileRow");
      for (let i = 0; i < rows.length; i++){
        rows[i].classList.remove("selected");
      }
      row.classList.add("selected");
      displayImage(file);
    }

    function displayImage(file){
      readFileAsBlob(file).then((blob) => {
        let url = URL.createObjectURL(new Blob([blob]));
        let img = new Image();
        img.src = url;
        img.onload = function(){
          let svg = document.querySelector('.imageSVG');
          svg.innerHTML = "";
          svg.setAttribute("viewBox", getViewBox(img));
          let svgImg = document.createElementNS("http://www.w3.org/2000/svg", "image");
          svgImg.setAttributeNS("http://www.w3.org/1999/xlink", "href", url);
          svg.appendChild(svgImg);
        }
      })
    }

    function getViewBox(img){
      return "0 0 " + img.naturalWidth + " " + img.naturalHeight;
    }

    function readFileAsText(file){
      return new Promise((resolve, reject) => {
        let reader = new FileReader();
        reader.onload = function(e){
          resolve(e.target.result);
        }
        reader.readAsText(file);
      })
    }

    function readFileAsBlob(file){
      return new Promise((resolve, reject) => {
        let reader = new FileReader();
        reader.onload = function(e){
          resolve(e.target.result);
        }
        reader.readAsArrayBuffer(file);
      })
    }
  </script>
</body>
</html>